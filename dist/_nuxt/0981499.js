(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{502:function(t,e,o){var content=o(527);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(22).default)("911ded44",content,!0,{sourceMap:!1})},526:function(t,e,o){"use strict";o(502)},527:function(t,e,o){var n=o(21)((function(i){return i[1]}));n.push([t.i,".table-container[data-v-755b9fe1]{background-color:#fff;border-radius:8px;box-shadow:0 4px 6px rgba(0,0,0,.2);margin:20px;padding:20px}.table-header[data-v-755b9fe1]{background-color:#3282b8;border-radius:15px;color:#fff;font-weight:700;padding:10px}.table-header[data-v-755b9fe1],.table-row[data-v-755b9fe1]{display:grid;grid-template-columns:1fr 1fr 1fr 1fr 1fr 2fr 1fr 1fr auto;grid-gap:10px;gap:10px}.table-row[data-v-755b9fe1]{border-bottom:1px solid #ddd;padding:10px 0}.table-row .delete-button[data-v-755b9fe1]{background-color:#e63946;border:none;border-radius:5px;color:#fff;cursor:pointer;padding:5px 10px;transition:background-color .3s ease}.table-row .delete-button[data-v-755b9fe1]:hover{background-color:#d62828}.table-row[data-v-755b9fe1]:nth-child(2n){background-color:#f9f9f9}.table-row[data-v-755b9fe1]:nth-child(odd){background-color:#fff}.table-row input[data-v-755b9fe1]{border:1px solid #ccc;border-radius:5px;padding:5px;width:100%}.add-row-button[data-v-755b9fe1]{background-color:#3282b8;border:none;border-radius:5px;color:#fff;cursor:pointer;margin-top:10px;padding:10px 15px;transition:background-color .3s ease}.add-row-button[data-v-755b9fe1]:hover{background-color:#205375}",""]),n.locals={},t.exports=n},534:function(t,e,o){"use strict";o.r(e);var n=o(238),c=o(517),r=o(490),l=o(569),d=o(489),f=o(632),m=o(541),v=o(630),h=o(213),_=o(558),x=o(486),k=o(533),C=o(531),F=o(631),V=o(30),T=(o(178),o(75),o(179),o(5),o(76),o(119),{props:{inside:{type:Boolean,default:!1},update:{type:Boolean,default:!1},ventaEditada:{type:Object,default:null}},data:function(){return{headers:[{text:"Producto"},{text:"Referencia"},{text:"Precio"},{text:"Descuento"},{text:"Impuesto"},{text:"Descripción"},{text:"Cantidad"},{text:"Total"},{text:"Acciones"}],contactos:[],productos:[],filas:[{item:null,referencia:"",precio:0,descuento:0,impuesto:0,descripcion:"",cantidad:1,total:0}],subtotal:0,impuestos:0,total:0,telefono:"",contactoSeleccionado:null,numeroNota:"",inicioFecha:"",terminoFecha:"",fechaVencimiento:"",menuInicioFecha:!1,menuTerminoVisible:!1,menuVencimiento:!1,notas:""}},watch:{ventaEditada:function(t){t&&this.cargarVenta(t)}},mounted:function(){var t=this;this.getContactos().then((function(){return t.getProductos()})).then((function(){t.update&&t.ventaEditada&&t.cargarVenta(t.ventaEditada)}))},methods:{getContactos:function(){var t=this;return Object(V.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.get("/clientes");case 3:(o=e.sent).data&&o.data.success&&(t.contactos=o.data.clientes),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error al obtener los contactos:",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},getProductos:function(){var t=this;return Object(V.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.get("/inventarios");case 3:(o=e.sent).data&&o.data.success&&(t.productos=o.data.inventarios),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error al obtener los productos:",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},cargarVenta:function(t){var e=this;this.contactoSeleccionado=null,this.telefono="",this.filas=[{item:null,referencia:"",precio:0,descuento:0,impuesto:0,descripcion:"",cantidad:1,total:0}];var o=this.contactos.find((function(e){return e.nombre.trim()===t.cliente.trim()}));o&&(this.contactoSeleccionado=o.id,this.telefono=o.telefono),this.numeroNota=t.nonota||"",this.tipoPago=t.tipopago||"",this.terminoFecha=t.fechatermino||"",this.fechaVencimiento=t.fechavencimiento||"",this.terminos=t.terminos||"",this.notas=t.notas||"",this.textoResolucion=t.resolucion||"",this.filas=t.producto.map((function(t){var o=e.productos.find((function(p){return p.item.trim()===t.nombreproducto.trim()}));return o?{item:o.id,referencia:t.referencia||"",precio:t.precio||0,descuento:t.descuento||0,impuesto:t.impuesto||0,descripcion:t.descripcion||"",cantidad:t.cantidad||1,total:t.total||0}:{item:null,referencia:t.referencia||"",precio:t.precio||0,descuento:t.descuento||0,impuesto:t.impuesto||0,descripcion:t.descripcion||"",cantidad:t.cantidad||1,total:t.total||0}})),this.calcularTotales()},agregarFila:function(){this.filas.push({item:null,referencia:"",precio:0,descuento:0,impuesto:0,descripcion:"",cantidad:1,total:0})},eliminarFila:function(t){this.filas.splice(t,1),this.calcularTotales()},actualizarPrecio:function(t){var e=this.filas[t].item,o=this.productos.find((function(t){return t.id===e}));o&&(this.filas[t].precio=o.precio,this.filas[t].referencia=o.ref,this.filas[t].descripcion=o.descripcion,this.calcularTotal(t))},calcularTotal:function(t){var e=this.filas[t],o=e.precio*e.cantidad,n=e.descuento/100*o,c=e.impuesto/100*(o-n);e.total=o-n+c,this.calcularTotales()},calcularTotales:function(){this.subtotal=this.filas.reduce((function(t,e){return t+e.total}),0),this.impuestos=this.filas.reduce((function(t,e){return t+e.impuesto/100*(e.precio*e.cantidad)}),0),this.total=this.subtotal+this.impuestos},guardarVenta:function(){var t=this,e=this.filas.map((function(e){var o=t.productos.find((function(t){return t.id===e.item}));return{nombreproducto:(null==o?void 0:o.item)||"",referencia:e.referencia||"",precio:parseFloat(e.precio)||0,descuento:parseFloat(e.descuento)||0,impuesto:parseFloat(e.impuesto)||0,descripcion:e.descripcion||"",cantidad:parseInt(e.cantidad)||0,total:parseFloat(e.total)||0}}));if(e.every((function(p){return p.nombreproducto&&p.referencia&&p.precio>=0&&p.cantidad>0&&p.total>=0}))){var o=this.contactos.find((function(e){return e.id===t.contactoSeleccionado})),n={nonota:this.numeroNota,cliente:o.nombre,telefono:o.telefono,tipopago:this.tipoPago,fechatermino:this.terminoFecha,fechavencimiento:this.fechaVencimiento,producto:e,terminos:this.terminos,notas:this.notas,resolucion:this.textoResolucion,total:this.total};this.update?this.$axios.put("/ventas/update/".concat(this.ventaEditada.id),n).then((function(e){e.data.success?(t.limpiarFormulario(),t.$emit("guardado")):console.error(e.data.message)})).catch((function(t){console.error("Error al actualizar la factura",t)})):this.$axios.post("/ventas/create",n).then((function(e){e.data.success?(t.limpiarFormulario(),t.$emit("guardado")):console.error(e.data.message)})).catch((function(t){console.error("Error al guardar la factura",t)}))}else alert("Hay errores en los datos de los productos. Por favor, verifica.")},limpiarFormulario:function(){this.contactoSeleccionado=null,this.numeroNota="",this.tipoPago="",this.terminoFecha="",this.fechaVencimiento="",this.terminos="",this.filas=[{item:null,referencia:"",precio:0,descuento:0,impuesto:0,descripcion:"",cantidad:1,total:0}],this.subtotal=0,this.impuestos=0,this.total=0,this.textoResolucion="",this.notas=""},actualizarTelefono:function(){var t=this,e=this.contactos.find((function(e){return e.id===t.contactoSeleccionado}));this.telefono=e?e.telefono:""},cancelar:function(){this.$emit("click-cancel")}}}),w=(o(526),o(67)),component=Object(w.a)(T,(function(){var t=this,e=t._self._c;return e(d.a,{staticClass:"quote-container",attrs:{width:"1000"}},[e(c.a,{attrs:{flat:"",elevation:"0",color:"#FFFFFF"}},[e(r.c,[e("div",{staticClass:"d-flex justify-space-between align-center"},[e("h1",{staticClass:"title"},[t._v("\n          "+t._s(t.inside&&t.update?"Actualiza la Factura":t.inside?"Registra Nueva Factura":"")+"\n        ")])])]),t._v(" "),e(r.b,[e(v.a,{on:{submit:function(e){return e.preventDefault(),t.guardarVenta.apply(null,arguments)}}},[e(x.a,[e(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"4"}},[e("h4",{staticClass:"mr-2"},[t._v("\n              No. Nota\n            ")]),t._v(" "),e(C.a,{staticClass:"text-right",attrs:{label:"No. Nota",dense:"",outlined:""},model:{value:t.numeroNota,callback:function(e){t.numeroNota=e},expression:"numeroNota"}})],1)],1),t._v(" "),e(x.a,[e(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"4"}},[e("h4",{staticClass:"mr-2"},[t._v("\n              Contacto\n            ")]),t._v(" "),e(k.a,{attrs:{items:t.contactos,"item-text":"nombre","item-value":"id",label:"Contacto",dense:"",outlined:"",required:""},on:{change:t.actualizarTelefono},model:{value:t.contactoSeleccionado,callback:function(e){t.contactoSeleccionado=e},expression:"contactoSeleccionado"}})],1),t._v(" "),e(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"4"}},[e("h4",{staticClass:"mr-2"},[t._v("\n              Teléfono\n            ")]),t._v(" "),e(C.a,{attrs:{label:"Teléfono",dense:"",outlined:"",disabled:"",required:"",readonly:""},model:{value:t.telefono,callback:function(e){t.telefono=e},expression:"telefono"}})],1),t._v(" "),e(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"4"}},[e("h4",{staticClass:"mr-2"},[t._v("\n              Tipo de pago\n            ")]),t._v(" "),e(k.a,{attrs:{items:["Contado","Crédito"],label:"Tipo de pago",dense:"",outlined:"",required:""},model:{value:t.tipoPago,callback:function(e){t.tipoPago=e},expression:"tipoPago"}})],1)],1),t._v(" "),e(x.a,[e(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"6"}},[e("h4",{staticClass:"mr-2"},[t._v("\n              Fecha de Inicio\n            ")]),t._v(" "),e(_.a,{ref:"menuTermino",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(o){var n=o.on,c=o.attrs;return[e(C.a,t._g(t._b({attrs:{label:"Término",readonly:"",dense:"",outlined:""},model:{value:t.terminoFecha,callback:function(e){t.terminoFecha=e},expression:"terminoFecha"}},"v-text-field",c,!1),n))]}}]),model:{value:t.menuTerminoVisible,callback:function(e){t.menuTerminoVisible=e},expression:"menuTerminoVisible"}},[t._v(" "),e(f.a,{on:{input:function(e){t.menuTerminoVisible=!1}},model:{value:t.terminoFecha,callback:function(e){t.terminoFecha=e},expression:"terminoFecha"}})],1)],1),t._v(" "),e(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"6"}},[e("h4",{staticClass:"mr-2"},[t._v("\n              Fecha de Vencimiento\n            ")]),t._v(" "),e(_.a,{ref:"menuVencimiento",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(o){var n=o.on,c=o.attrs;return[e(C.a,t._g(t._b({attrs:{label:"Fecha de Vencimiento",readonly:"",dense:"",outlined:""},model:{value:t.fechaVencimiento,callback:function(e){t.fechaVencimiento=e},expression:"fechaVencimiento"}},"v-text-field",c,!1),n))]}}]),model:{value:t.menuVencimiento,callback:function(e){t.menuVencimiento=e},expression:"menuVencimiento"}},[t._v(" "),e(f.a,{on:{input:function(e){t.menuVencimiento=!1}},model:{value:t.fechaVencimiento,callback:function(e){t.fechaVencimiento=e},expression:"fechaVencimiento"}})],1)],1)],1),t._v(" "),e(m.a),t._v(" "),e("div",{staticClass:"mt-3"},[e("div",{staticClass:"table-header"},t._l(t.headers,(function(header){return e("div",{key:header.text,staticClass:"table-cell"},[t._v("\n              "+t._s(header.text)+"\n            ")])})),0),t._v(" "),t._l(t.filas,(function(o,c){return e("div",{key:c,staticClass:"table-row"},[e(k.a,{staticClass:"table-cell",attrs:{items:t.productos,"item-text":"item","item-value":"id",label:"Producto",dense:"",outlined:""},on:{change:function(e){return t.actualizarPrecio(c)}},model:{value:o.item,callback:function(e){t.$set(o,"item",e)},expression:"fila.item"}}),t._v(" "),e("div",{staticClass:"table-cell"},[t._v("\n              "+t._s(o.referencia)+"\n            ")]),t._v(" "),e("div",{staticClass:"table-cell"},[t._v("\n              "+t._s(o.precio)+"\n            ")]),t._v(" "),e(C.a,{staticClass:"table-cell",attrs:{type:"number",dense:"",outlined:""},on:{input:function(e){return t.calcularTotal(c)}},model:{value:o.descuento,callback:function(e){t.$set(o,"descuento",e)},expression:"fila.descuento"}}),t._v(" "),e(C.a,{staticClass:"table-cell",attrs:{type:"number",dense:"",outlined:""},on:{input:function(e){return t.calcularTotal(c)}},model:{value:o.impuesto,callback:function(e){t.$set(o,"impuesto",e)},expression:"fila.impuesto"}}),t._v(" "),e("div",{staticClass:"table-cell"},[t._v("\n              "+t._s(o.descripcion)+"\n            ")]),t._v(" "),e(C.a,{staticClass:"table-cell",attrs:{type:"number",dense:"",outlined:""},on:{input:function(e){return t.calcularTotal(c)}},model:{value:o.cantidad,callback:function(e){t.$set(o,"cantidad",e)},expression:"fila.cantidad"}}),t._v(" "),e("div",{staticClass:"table-cell"},[t._v("\n              "+t._s(o.total)+"\n            ")]),t._v(" "),e(n.a,{staticClass:"table-cell",attrs:{icon:"",color:"red"},on:{click:function(e){return t.eliminarFila(c)}}},[e(h.a,[t._v("mdi-delete")])],1)],1)})),t._v(" "),e(n.a,{staticClass:"my-3",attrs:{color:"blue",outlined:""},on:{click:t.agregarFila}},[t._v("\n            Agregar nueva fila\n          ")])],2),t._v(" "),e("div",{staticClass:"totales-container"},[e(x.a,[e(l.a,{attrs:{cols:"12",sm:"4","offset-sm":"8"}},[e(x.a,[e(l.a,[e("p",[e("strong",[t._v("Subtotal:")]),t._v(" "+t._s(t.subtotal))]),t._v(" "),e("p",[e("strong",[t._v("Impuestos:")]),t._v(" "+t._s(t.impuestos))]),t._v(" "),e("p",[e("strong",[t._v("Total:")]),t._v(" "+t._s(t.total))])])],1)],1)],1)],1),t._v(" "),e(m.a),t._v(" "),e(x.a,[e(l.a,{attrs:{cols:"12",sm:"4"}},[e("h4",{staticClass:"mr-2"},[t._v("\n              Términos y condiciones\n            ")]),t._v(" "),e(F.a,{attrs:{label:"Términos y condiciones",dense:"",outlined:""},model:{value:t.terminos,callback:function(e){t.terminos=e},expression:"terminos"}})],1),t._v(" "),e(l.a,{attrs:{cols:"12",sm:"4"}},[e("h4",{staticClass:"mr-2"},[t._v("\n              Notas\n            ")]),t._v(" "),e(F.a,{attrs:{label:"Notas",dense:"",outlined:""},model:{value:t.notas,callback:function(e){t.notas=e},expression:"notas"}})],1),t._v(" "),e(l.a,{attrs:{cols:"12",sm:"4"}},[e("h4",{staticClass:"mr-2"},[t._v("\n              Texto de Resolución\n            ")]),t._v(" "),e(F.a,{attrs:{label:"Texto de Resolución",dense:"",outlined:""},model:{value:t.textoResolucion,callback:function(e){t.textoResolucion=e},expression:"textoResolucion"}})],1)],1),t._v(" "),e(m.a),t._v(" "),e(x.a,[e(l.a,{staticClass:"d-flex justify-space-between",attrs:{cols:"12"}},[e(n.a,{attrs:{outlined:"",color:"grey"},on:{click:t.cancelar}},[t._v("\n              Cancelar\n            ")]),t._v(" "),e(n.a,{attrs:{outlined:"",color:"grey"}},[t._v("\n              Previsualizar\n            ")]),t._v(" "),e(n.a,{attrs:{color:"blue"},on:{click:t.guardarVenta}},[t._v("\n              "+t._s(t.inside&&t.update?"Actualizar":t.inside?"Guardar":"")+"\n            ")])],1)],1)],1)],1)],1)],1)}),[],!1,null,"755b9fe1",null);e.default=component.exports}}]);