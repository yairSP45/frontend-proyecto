(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{503:function(e,t,n){var content=n(529);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(22).default)("23437d98",content,!0,{sourceMap:!1})},514:function(e,t,n){"use strict";n.r(t);var c=n(238),o=n(517),r=n(490),l=n(569),d=n(489),f=n(632),m=n(630),h=n(213),v=n(558),x=n(486),_=n(533),F=n(531),S=n(631),k=n(30),y=(n(178),n(75),n(179),n(5),n(76),n(119),{props:{inside:{type:Boolean,default:!1},update:{type:Boolean,default:!1},facturaEditada:{type:Object,default:null}},data:function(){return{headers:[{text:"Producto"},{text:"Referencia"},{text:"Precio"},{text:"Descuento"},{text:"Impuesto"},{text:"Descripción"},{text:"Cantidad"},{text:"Total"},{text:"Acciones"}],contactos:[],productos:[],filas:[{item:null,referencia:"",precio:0,descuento:0,impuesto:0,descripcion:"",cantidad:1,total:0}],subtotal:0,impuestos:0,total:0,telefono:"",contactoSeleccionado:null,numeracionSeleccionada:"",fechaInicio:"",ultimaFecha:"",terminoFecha:"",fechaExpiracion:"",menuFecha:!1,menuVencimiento:!1,menuTerminoVisible:!1,menuExpiracionVisible:!1,observaciones:"",listaPrecioSeleccionada:"",frecuenciaSeleccionada:""}},watch:{facturaEditada:function(e){e&&this.cargarFactura(e)}},mounted:function(){var e=this;this.getContactos().then((function(){return e.getProductos()})).then((function(){e.update&&e.facturaEditada&&e.cargarFactura(e.facturaEditada)}))},methods:{getContactos:function(){var e=this;return Object(k.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$axios.get("/clientes");case 3:(n=t.sent).data&&n.data.success&&(e.contactos=n.data.clientes),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("Error al obtener los contactos:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getProductos:function(){var e=this;return Object(k.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$axios.get("/inventarios");case 3:(n=t.sent).data&&n.data.success&&(e.productos=n.data.inventarios),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("Error al obtener los productos:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},cargarFactura:function(e){var t=this;this.contactoSeleccionado=null,this.telefono="",this.filas=[{item:null,referencia:"",precio:0,descuento:0,impuesto:0,descripcion:"",cantidad:1,total:0}];var n=this.contactos.find((function(t){return t.nombre.trim()===e.cliente.trim()}));n&&(this.contactoSeleccionado=n.id,this.telefono=n.telefono),this.numeracionSeleccionada=e.numeracion||"",this.fechaInicio=e.iniciofecha||"",this.ultimaFecha=e.ultimafecha||"",this.terminoFecha=e.termino||"",this.fechaExpiracion=e.expiracion||"",this.frecuenciaSeleccionada=e.frecuencia||"",this.listaPrecioSeleccionada=e.listprecio||"",this.notas=e.notafacturas||"",this.observaciones=e.observaciones||"",this.filas=e.producto.map((function(e){var n=t.productos.find((function(p){return p.item.trim()===e.nombreproducto.trim()}));return n?{item:n.id,referencia:e.referencia||"",precio:e.precio||0,descuento:e.descuento||0,impuesto:e.impuesto||0,descripcion:e.descripcion||"",cantidad:e.cantidad||1,total:e.total||0}:{item:null,referencia:e.referencia||"",precio:e.precio||0,descuento:e.descuento||0,impuesto:e.impuesto||0,descripcion:e.descripcion||"",cantidad:e.cantidad||1,total:e.total||0}})),this.calcularTotales()},agregarFila:function(){this.filas.push({item:null,referencia:"",precio:0,descuento:0,impuesto:0,descripcion:"",cantidad:1,total:0})},eliminarFila:function(e){this.filas.splice(e,1),this.calcularTotales()},actualizarPrecio:function(e){var t=this.filas[e].item,n=this.productos.find((function(e){return e.id===t}));n&&(this.filas[e].precio=n.precio,this.filas[e].referencia=n.ref,this.filas[e].descripcion=n.descripcion,this.calcularTotal(e))},calcularTotal:function(e){var t=this.filas[e],n=t.precio*t.cantidad,c=t.descuento/100*n,o=t.impuesto/100*(n-c);t.total=n-c+o,this.calcularTotales()},calcularTotales:function(){this.subtotal=this.filas.reduce((function(e,t){return e+t.total}),0),this.impuestos=this.filas.reduce((function(e,t){return e+t.impuesto/100*(t.precio*t.cantidad)}),0),this.total=this.subtotal+this.impuestos},guardarFactura:function(){var e=this,t=this.filas.map((function(t){var n=e.productos.find((function(e){return e.id===t.item}));return{nombreproducto:(null==n?void 0:n.item)||"",referencia:t.referencia||"",precio:parseFloat(t.precio)||0,descuento:parseFloat(t.descuento)||0,impuesto:parseFloat(t.impuesto)||0,descripcion:t.descripcion||"",cantidad:parseInt(t.cantidad)||0,total:parseFloat(t.total)||0}}));if(t.every((function(p){return p.nombreproducto&&p.referencia&&p.precio>=0&&p.cantidad>0&&p.total>=0}))){var n=this.contactos.find((function(t){return t.id===e.contactoSeleccionado})),c={numeracion:this.numeracionSeleccionada,cliente:n.nombre,telefono:n.telefono,observaciones:this.observaciones,iniciofecha:this.fechaInicio,ultimafecha:this.ultimaFecha,termino:this.terminoFecha,expiracion:this.fechaExpiracion,frecuencia:this.frecuenciaSeleccionada,listprecio:this.listaPrecioSeleccionada,notafacturas:this.notas,producto:t,total:this.total};this.update?this.$axios.put("/facturas/update/".concat(this.facturaEditada.id),c).then((function(t){t.data.success?(e.limpiarFormulario(),e.$emit("guardado")):console.error(t.data.message)})).catch((function(e){console.error("Error al actualizar la factura",e)})):this.$axios.post("/facturas/create",c).then((function(t){t.data.success?(e.limpiarFormulario(),e.$emit("guardado")):console.error(t.data.message)})).catch((function(e){console.error("Error al guardar la factura",e)}))}else alert("Hay errores en los datos de los productos. Por favor, verifica.")},limpiarFormulario:function(){this.contactoSeleccionado=null,this.numeracionSeleccionada="",this.observaciones="",this.fechaInicio="",this.ultimaFecha="",this.terminoFecha="",this.fechaExpiracion="",this.frecuenciaSeleccionada="",this.listaPrecioSeleccionada="",this.notas="",this.filas=[{item:null,referencia:"",precio:0,descuento:0,impuesto:0,descripcion:"",cantidad:1,total:0}],this.subtotal=0,this.impuestos=0,this.total=0},actualizarTelefono:function(){var e=this,t=this.contactos.find((function(t){return t.id===e.contactoSeleccionado}));this.telefono=t?t.telefono:""},cancelar:function(){this.$emit("click-cancel")}}}),C=(n(528),n(67)),component=Object(C.a)(y,(function(){var e=this,t=e._self._c;return t(d.a,{staticClass:"quote-container",attrs:{width:"1000"}},[t(o.a,{attrs:{flat:"",elevation:"0",color:"#FFFFFF"}},[t(r.c,[t("div",{staticClass:"d-flex justify-space-between align-center"},[t("h1",{staticClass:"title"},[e._v("\n          "+e._s(e.inside&&e.update?"Actualiza la Factura recurrente":e.inside?"Registra Nueva Factura Recurrente":"")+"\n        ")])])]),e._v(" "),t(r.b,[t(m.a,{on:{submit:function(t){return t.preventDefault(),e.guardarFactura.apply(null,arguments)}}},[t(x.a,[t(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"4"}},[t("h4",{staticClass:"mr-2"},[e._v("\n              Numeración\n            ")]),e._v(" "),t(F.a,{attrs:{label:"Numeración",dense:"",outlined:"",required:""},model:{value:e.numeracionSeleccionada,callback:function(t){e.numeracionSeleccionada=t},expression:"numeracionSeleccionada"}})],1),e._v(" "),t(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"4"}},[t("h4",{staticClass:"mr-2"},[e._v("\n              Contacto\n            ")]),e._v(" "),t(_.a,{attrs:{items:e.contactos,"item-text":"nombre","item-value":"id",label:"Contacto",dense:"",outlined:"",required:""},on:{change:e.actualizarTelefono},model:{value:e.contactoSeleccionado,callback:function(t){e.contactoSeleccionado=t},expression:"contactoSeleccionado"}})],1),e._v(" "),t(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"4"}},[t("h4",{staticClass:"mr-2"},[e._v("\n              Teléfono\n            ")]),e._v(" "),t(F.a,{attrs:{label:"Teléfono",dense:"",outlined:"",disabled:"",required:"",readonly:""},model:{value:e.telefono,callback:function(t){e.telefono=t},expression:"telefono"}})],1)],1),e._v(" "),t(x.a,[t(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"6"}},[t("h4",{staticClass:"mr-2"},[e._v("\n              Fecha de inicio\n            ")]),e._v(" "),t(v.a,{ref:"menu1",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(n){var c=n.on,o=n.attrs;return[t(F.a,e._g(e._b({attrs:{label:"Fecha de inicio",readonly:"",dense:"",outlined:""},model:{value:e.fechaInicio,callback:function(t){e.fechaInicio=t},expression:"fechaInicio"}},"v-text-field",o,!1),c))]}}]),model:{value:e.menuFecha,callback:function(t){e.menuFecha=t},expression:"menuFecha"}},[e._v(" "),t(f.a,{on:{input:function(t){e.menuFecha=!1}},model:{value:e.fechaInicio,callback:function(t){e.fechaInicio=t},expression:"fechaInicio"}})],1)],1),e._v(" "),t(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"6"}},[t("h4",{staticClass:"mr-2"},[e._v("\n              Última fecha\n            ")]),e._v(" "),t(v.a,{ref:"menu2",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(n){var c=n.on,o=n.attrs;return[t(F.a,e._g(e._b({attrs:{label:"Última fecha",readonly:"",dense:"",outlined:""},model:{value:e.ultimaFecha,callback:function(t){e.ultimaFecha=t},expression:"ultimaFecha"}},"v-text-field",o,!1),c))]}}]),model:{value:e.menuVencimiento,callback:function(t){e.menuVencimiento=t},expression:"menuVencimiento"}},[e._v(" "),t(f.a,{on:{input:function(t){e.menuVencimiento=!1}},model:{value:e.ultimaFecha,callback:function(t){e.ultimaFecha=t},expression:"ultimaFecha"}})],1)],1)],1),e._v(" "),t(x.a,[t(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"3"}},[t("h4",{staticClass:"mr-2"},[e._v("\n              Término\n            ")]),e._v(" "),t(v.a,{ref:"menuTermino",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(n){var c=n.on,o=n.attrs;return[t(F.a,e._g(e._b({attrs:{label:"Término",readonly:"",dense:"",outlined:""},model:{value:e.terminoFecha,callback:function(t){e.terminoFecha=t},expression:"terminoFecha"}},"v-text-field",o,!1),c))]}}]),model:{value:e.menuTerminoVisible,callback:function(t){e.menuTerminoVisible=t},expression:"menuTerminoVisible"}},[e._v(" "),t(f.a,{on:{input:function(t){e.menuTerminoVisible=!1}},model:{value:e.terminoFecha,callback:function(t){e.terminoFecha=t},expression:"terminoFecha"}})],1)],1),e._v(" "),t(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"3"}},[t("h4",{staticClass:"mr-2"},[e._v("\n              Fecha de expiración\n            ")]),e._v(" "),t(v.a,{ref:"menuExpiracion",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(n){var c=n.on,o=n.attrs;return[t(F.a,e._g(e._b({attrs:{label:"Fecha de expiración",readonly:"",dense:"",outlined:""},model:{value:e.fechaExpiracion,callback:function(t){e.fechaExpiracion=t},expression:"fechaExpiracion"}},"v-text-field",o,!1),c))]}}]),model:{value:e.menuExpiracionVisible,callback:function(t){e.menuExpiracionVisible=t},expression:"menuExpiracionVisible"}},[e._v(" "),t(f.a,{on:{input:function(t){e.menuExpiracionVisible=!1}},model:{value:e.fechaExpiracion,callback:function(t){e.fechaExpiracion=t},expression:"fechaExpiracion"}})],1)],1),e._v(" "),t(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"3"}},[t("h4",{staticClass:"mr-2"},[e._v("\n              Frecuencia\n            ")]),e._v(" "),t(_.a,{attrs:{items:["1","2","3","4","5","6","7","8","9","10"],"item-text":"nombre","item-value":"id",label:"Frecuencia",dense:"",outlined:""},model:{value:e.frecuenciaSeleccionada,callback:function(t){e.frecuenciaSeleccionada=t},expression:"frecuenciaSeleccionada"}})],1),e._v(" "),t(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"3"}},[t("h4",{staticClass:"mr-2"},[e._v("\n              Lista de precio\n            ")]),e._v(" "),t(_.a,{attrs:{items:["General","Mayoritario"],"item-text":"nombre","item-value":"id",label:"Lista de precio",dense:"",outlined:""},model:{value:e.listaPrecioSeleccionada,callback:function(t){e.listaPrecioSeleccionada=t},expression:"listaPrecioSeleccionada"}})],1)],1),e._v(" "),t(x.a,[t(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"4"}},[t("h4",{staticClass:"mr-2"},[e._v("\n              Notas de Factura\n            ")]),e._v(" "),t(S.a,{attrs:{label:"Notas de Factura",dense:"",outlined:""},model:{value:e.notas,callback:function(t){e.notas=t},expression:"notas"}})],1),e._v(" "),t(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"4"}},[t("h4",{staticClass:"mr-2"},[e._v("\n              Observaciones\n            ")]),e._v(" "),t(S.a,{attrs:{label:"Observaciones",dense:"",outlined:""},model:{value:e.observaciones,callback:function(t){e.observaciones=t},expression:"observaciones"}})],1)],1),e._v(" "),t("div",{staticStyle:{"background-color":"white","border-radius":"8px",padding:"20px",margin:"20px","box-shadow":"0 4px 6px rgba(0, 0, 0, 0.2)"}},[t("div",{staticStyle:{display:"flex","background-color":"#3282B8",color:"white",padding:"10px","border-radius":"15px"}},e._l(e.headers,(function(header){return t("div",{key:header.text,staticStyle:{flex:"1","text-align":"center","font-weight":"bold"}},[e._v("\n              "+e._s(header.text)+"\n            ")])})),0),e._v(" "),e._l(e.filas,(function(n,o){return t("div",{key:o,staticStyle:{display:"flex",padding:"10px","border-bottom":"1px solid #ccc"}},[t("div",{staticStyle:{flex:"1","text-align":"center"}},[t(_.a,{attrs:{items:e.productos,"item-text":"item","item-value":"id",label:"Producto",dense:"",outlined:""},on:{change:function(t){return e.actualizarPrecio(o)}},model:{value:n.item,callback:function(t){e.$set(n,"item",t)},expression:"fila.item"}})],1),e._v(" "),t("div",{staticStyle:{flex:"1","text-align":"center"}},[e._v("\n              "+e._s(n.referencia)+"\n            ")]),e._v(" "),t("div",{staticStyle:{flex:"1","text-align":"center"}},[e._v("\n              "+e._s(n.precio)+"\n            ")]),e._v(" "),t("div",{staticStyle:{flex:"1","text-align":"center"}},[t(F.a,{attrs:{type:"number",dense:"",outlined:""},on:{input:function(t){return e.calcularTotal(o)}},model:{value:n.descuento,callback:function(t){e.$set(n,"descuento",t)},expression:"fila.descuento"}})],1),e._v(" "),t("div",{staticStyle:{flex:"1","text-align":"center"}},[t(F.a,{attrs:{type:"number",dense:"",outlined:""},on:{input:function(t){return e.calcularTotal(o)}},model:{value:n.impuesto,callback:function(t){e.$set(n,"impuesto",t)},expression:"fila.impuesto"}})],1),e._v(" "),t("div",{staticStyle:{flex:"1","text-align":"center"}},[e._v("\n              "+e._s(n.descripcion)+"\n            ")]),e._v(" "),t("div",{staticStyle:{flex:"1","text-align":"center"}},[t(F.a,{attrs:{type:"number",dense:"",outlined:""},on:{input:function(t){return e.calcularTotal(o)}},model:{value:n.cantidad,callback:function(t){e.$set(n,"cantidad",t)},expression:"fila.cantidad"}})],1),e._v(" "),t("div",{staticStyle:{flex:"1","text-align":"center"}},[e._v("\n              "+e._s(n.total)+"\n            ")]),e._v(" "),t("div",{staticStyle:{flex:"1","text-align":"center"}},[t(c.a,{attrs:{icon:"",color:"red"},on:{click:function(t){return e.eliminarFila(o)}}},[t(h.a,[e._v("mdi-delete")])],1)],1)])}))],2),e._v(" "),t(c.a,{staticClass:"my-3",attrs:{color:"blue",outlined:""},on:{click:e.agregarFila}},[e._v("\n          Agregar nueva fila\n        ")]),e._v(" "),t(x.a,[t(l.a,{attrs:{cols:"12",sm:"4","offset-sm":"8"}},[t(x.a,[t(l.a,[t("p",[t("strong",[e._v("Subtotal:")]),e._v(" "+e._s(e.subtotal))]),e._v(" "),t("p",[t("strong",[e._v("Impuestos:")]),e._v(" "+e._s(e.impuestos))]),e._v(" "),t("p",[t("strong",[e._v("Total:")]),e._v(" "+e._s(e.total))])])],1)],1)],1),e._v(" "),t(x.a,[t(l.a,{staticClass:"d-flex justify-space-between",attrs:{cols:"12"}},[t(c.a,{attrs:{outlined:"",color:"grey"},on:{click:e.cancelar}},[e._v("\n              Cancelar\n            ")]),e._v(" "),t(c.a,{attrs:{color:"blue"},on:{click:e.guardarFactura}},[e._v("\n              "+e._s(e.inside&&e.update?"Actualizar":e.inside?"Guardar":"")+"\n            ")])],1)],1)],1)],1)],1)],1)}),[],!1,null,"75232694",null);t.default=component.exports},528:function(e,t,n){"use strict";n(503)},529:function(e,t,n){var c=n(21)((function(i){return i[1]}));c.push([e.i,".quote-container[data-v-75232694]{margin:0 auto}",""]),c.locals={},e.exports=c}}]);