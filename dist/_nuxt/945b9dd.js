(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{513:function(t,e,n){"use strict";n.r(e);var o=n(238),c=n(517),r=n(490),l=n(569),d=n(489),f=n(632),m=n(630),h=n(213),v=n(558),x=n(486),_=n(533),y=n(531),k=n(631),C=n(30),F=(n(178),n(75),n(179),n(5),n(76),n(119),{props:{inside:{type:Boolean,default:!1},update:{type:Boolean,default:!1},cotizacionEditada:{type:Object,default:null}},data:function(){return{headers:[{text:"Producto"},{text:"Referencia"},{text:"Precio"},{text:"Descuento"},{text:"Impuesto"},{text:"Descripción"},{text:"Cantidad"},{text:"Total"},{text:"Acciones"}],contactos:[],productos:[],filas:[{item:null,referencia:"",precio:0,descuento:0,impuesto:0,descripcion:"",cantidad:1,total:0}],subtotal:0,impuestos:0,total:0,telefono:"",contactoSeleccionado:null,numeroNota:"",fecha:"",fechaVencimiento:"",menuFecha:!1,menuVencimiento:!1,notas:""}},watch:{cotizacionEditada:function(t){t&&this.cargarCotizacion(t)}},mounted:function(){var t=this;this.getContactos().then((function(){return t.getProductos()})).then((function(){t.update&&t.cotizacionEditada&&t.cargarCotizacion(t.cotizacionEditada)}))},methods:{getContactos:function(){var t=this;return Object(C.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.get("/clientes");case 3:(n=e.sent).data&&n.data.success&&(t.contactos=n.data.clientes),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error al obtener los contactos:",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},getProductos:function(){var t=this;return Object(C.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.get("/inventarios");case 3:(n=e.sent).data&&n.data.success&&(t.productos=n.data.inventarios),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error al obtener los productos:",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},cargarCotizacion:function(t){var e=this;this.contactoSeleccionado=null,this.telefono="",this.filas=[{item:null,referencia:"",precio:0,descuento:0,impuesto:0,descripcion:"",cantidad:1,total:0}];var n=this.contactos.find((function(e){return e.nombre.trim()===t.cliente.trim()}));n&&(this.contactoSeleccionado=n.id,this.telefono=n.telefono),this.numeroNota=t.numeronota||"",this.fecha=t.creacion||"",this.fechaVencimiento=t.vencimiento||"",this.notas=t.notas||"",this.filas=t.producto.map((function(t){var n=e.productos.find((function(p){return p.item.trim()===t.nombreproducto.trim()}));return n?{item:n.id,referencia:t.referencia||"",precio:t.precio||0,descuento:t.descuento||0,impuesto:t.impuesto||0,descripcion:t.descripcion||"",cantidad:t.cantidad||1,total:t.total||0}:{item:null,referencia:t.referencia||"",precio:t.precio||0,descuento:t.descuento||0,impuesto:t.impuesto||0,descripcion:t.descripcion||"",cantidad:t.cantidad||1,total:t.total||0}})),this.calcularTotales()},agregarFila:function(){this.filas.push({item:null,referencia:"",precio:0,descuento:0,impuesto:0,descripcion:"",cantidad:1,total:0})},eliminarFila:function(t){this.filas.splice(t,1),this.calcularTotales()},actualizarPrecio:function(t){var e=this.filas[t].item,n=this.productos.find((function(t){return t.id===e}));n&&(this.filas[t].precio=n.precio,this.filas[t].referencia=n.ref,this.filas[t].descripcion=n.descripcion,this.calcularTotal(t))},calcularTotal:function(t){var e=this.filas[t],n=e.precio*e.cantidad,o=e.descuento/100*n,c=e.impuesto/100*(n-o);e.total=n-o+c,this.calcularTotales()},calcularTotales:function(){this.subtotal=this.filas.reduce((function(t,e){return t+e.total}),0),this.impuestos=this.filas.reduce((function(t,e){return t+e.impuesto/100*(e.precio*e.cantidad)}),0),this.total=this.subtotal+this.impuestos},guardarCotizacion:function(){var t=this,e=this.filas.map((function(e){var n=t.productos.find((function(t){return t.id===e.item}));return{nombreproducto:(null==n?void 0:n.item)||"",referencia:e.referencia||"",precio:parseFloat(e.precio)||0,descuento:parseFloat(e.descuento)||0,impuesto:parseFloat(e.impuesto)||0,descripcion:e.descripcion||"",cantidad:parseInt(e.cantidad)||0,total:parseFloat(e.total)||0}}));if(e.every((function(p){return p.nombreproducto&&p.referencia&&p.precio>=0&&p.cantidad>0&&p.total>=0}))){var n=this.contactos.find((function(e){return e.id===t.contactoSeleccionado})),o={cliente:n.nombre,numero:n.telefono,numeronota:this.numeroNota,creacion:this.fecha,vencimiento:this.fechaVencimiento,producto:e,total:this.total,notas:this.notas};this.update?this.$axios.put("/cotizaciones/update/".concat(this.cotizacionEditada.id),o).then((function(e){e.data.success?(t.limpiarFormulario(),t.$emit("guardado")):console.error(e.data.message)})).catch((function(t){console.error("Error al actualizar la cotización",t)})):this.$axios.post("/cotizaciones/create",o).then((function(e){e.data.success?(t.limpiarFormulario(),t.$emit("guardado")):console.error(e.data.message)})).catch((function(t){console.error("Error al guardar la cotización",t)}))}else alert("Hay errores en los datos de los productos. Por favor, verifica.")},limpiarFormulario:function(){this.contactoSeleccionado=null,this.telefono="",this.numeroNota="",this.fecha="",this.fechaVencimiento="",this.filas=[{item:null,referencia:"",precio:0,descuento:0,impuesto:0,descripcion:"",cantidad:1,total:0}],this.subtotal=0,this.impuestos=0,this.total=0,this.notas=""},actualizarTelefono:function(){var t=this,e=this.contactos.find((function(e){return e.id===t.contactoSeleccionado}));this.telefono=e?e.telefono:""},cancelar:function(){this.limpiarFormulario(),this.$emit("click-cancel")}}}),S=n(67),component=Object(S.a)(F,(function(){var t=this,e=t._self._c;return e(d.a,{staticClass:"quote-container",attrs:{width:"1000"}},[e(c.a,{attrs:{flat:"",elevation:"0",color:"#FFFFFF"}},[e(r.c,[e("div",{staticClass:"d-flex justify-space-between align-center"},[e("h1",{staticClass:"title"},[t._v("\n          "+t._s(t.inside&&t.update?"Actualiza Cotización":t.inside?"Registra una Nueva Cotizacion":"")+"\n        ")])])]),t._v(" "),e(r.b,[e(m.a,{on:{submit:function(e){return e.preventDefault(),t.guardarCotizacion.apply(null,arguments)}}},[e(x.a,[e(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"4"}},[e("h4",{staticClass:"mr-2"},[t._v("\n              Contacto\n            ")]),t._v(" "),e(_.a,{attrs:{items:t.contactos,"item-text":"nombre","item-value":"id",label:"Contacto",dense:"",outlined:"",required:""},on:{change:t.actualizarTelefono},model:{value:t.contactoSeleccionado,callback:function(e){t.contactoSeleccionado=e},expression:"contactoSeleccionado"}})],1),t._v(" "),e(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"4"}},[e("h4",{staticClass:"mr-2"},[t._v("\n              Teléfono\n            ")]),t._v(" "),e(y.a,{attrs:{label:"Teléfono",outlined:"",dense:"",disabled:"",required:"",readonly:""},model:{value:t.telefono,callback:function(e){t.telefono=e},expression:"telefono"}})],1),t._v(" "),e(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"4"}},[e("h4",{staticClass:"mr-2"},[t._v("\n              Número de Nota\n            ")]),t._v(" "),e(y.a,{attrs:{label:"Número de Nota",outlined:"",dense:"",required:""},model:{value:t.numeroNota,callback:function(e){t.numeroNota=e},expression:"numeroNota"}})],1)],1),t._v(" "),e(x.a,[e(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"6"}},[e("h4",{staticClass:"mr-2"},[t._v("\n              Fecha\n            ")]),t._v(" "),e(v.a,{ref:"menu1",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(n){var o=n.on,c=n.attrs;return[e(y.a,t._g(t._b({attrs:{label:"Fecha",readonly:"",dense:"",outlined:""},model:{value:t.fecha,callback:function(e){t.fecha=e},expression:"fecha"}},"v-text-field",c,!1),o))]}}]),model:{value:t.menuFecha,callback:function(e){t.menuFecha=e},expression:"menuFecha"}},[t._v(" "),e(f.a,{on:{input:function(e){t.menuFecha=!1}},model:{value:t.fecha,callback:function(e){t.fecha=e},expression:"fecha"}})],1)],1),t._v(" "),e(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"6"}},[e("h4",{staticClass:"mr-2"},[t._v("\n              Vencimiento\n            ")]),t._v(" "),e(v.a,{ref:"menu2",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(n){var o=n.on,c=n.attrs;return[e(y.a,t._g(t._b({attrs:{label:"Fecha de Vencimiento",readonly:"",dense:"",outlined:""},model:{value:t.fechaVencimiento,callback:function(e){t.fechaVencimiento=e},expression:"fechaVencimiento"}},"v-text-field",c,!1),o))]}}]),model:{value:t.menuVencimiento,callback:function(e){t.menuVencimiento=e},expression:"menuVencimiento"}},[t._v(" "),e(f.a,{on:{input:function(e){t.menuVencimiento=!1}},model:{value:t.fechaVencimiento,callback:function(e){t.fechaVencimiento=e},expression:"fechaVencimiento"}})],1)],1)],1),t._v(" "),e("div",{staticStyle:{"background-color":"white","border-radius":"8px",padding:"20px",margin:"20px","box-shadow":"0 4px 6px rgba(0, 0, 0, 0.2)"}},[e("div",{staticStyle:{display:"flex","background-color":"#3282B8",color:"white",padding:"10px","border-radius":"15px"}},t._l(t.headers,(function(header){return e("div",{key:header.text,staticStyle:{flex:"1","text-align":"center","font-weight":"bold"}},[t._v("\n              "+t._s(header.text)+"\n            ")])})),0),t._v(" "),t._l(t.filas,(function(n,c){return e("div",{key:c,staticStyle:{display:"flex",padding:"10px","border-bottom":"1px solid #ccc"}},[e("div",{staticStyle:{flex:"1","text-align":"center"}},[e(_.a,{attrs:{items:t.productos,"item-text":"item","item-value":"id",label:"Producto",dense:"",outlined:""},on:{change:function(e){return t.actualizarPrecio(c)}},model:{value:n.item,callback:function(e){t.$set(n,"item",e)},expression:"fila.item"}})],1),t._v(" "),e("div",{staticStyle:{flex:"1","text-align":"center"}},[t._v("\n              "+t._s(n.referencia)+"\n            ")]),t._v(" "),e("div",{staticStyle:{flex:"1","text-align":"center"}},[t._v("\n              "+t._s(n.precio)+"\n            ")]),t._v(" "),e("div",{staticStyle:{flex:"1","text-align":"center"}},[e(y.a,{attrs:{type:"number",dense:"",outlined:""},on:{input:function(e){return t.calcularTotal(c)}},model:{value:n.descuento,callback:function(e){t.$set(n,"descuento",e)},expression:"fila.descuento"}})],1),t._v(" "),e("div",{staticStyle:{flex:"1","text-align":"center"}},[e(y.a,{attrs:{type:"number",dense:"",outlined:""},on:{input:function(e){return t.calcularTotal(c)}},model:{value:n.impuesto,callback:function(e){t.$set(n,"impuesto",e)},expression:"fila.impuesto"}})],1),t._v(" "),e("div",{staticStyle:{flex:"1","text-align":"center"}},[t._v("\n              "+t._s(n.descripcion)+"\n            ")]),t._v(" "),e("div",{staticStyle:{flex:"1","text-align":"center"}},[e(y.a,{attrs:{type:"number",dense:"",outlined:""},on:{input:function(e){return t.calcularTotal(c)}},model:{value:n.cantidad,callback:function(e){t.$set(n,"cantidad",e)},expression:"fila.cantidad"}})],1),t._v(" "),e("div",{staticStyle:{flex:"1","text-align":"center"}},[t._v("\n              "+t._s(n.total)+"\n            ")]),t._v(" "),e("div",{staticStyle:{flex:"1","text-align":"center"}},[e(o.a,{attrs:{icon:"",color:"red"},on:{click:function(e){return t.eliminarFila(c)}}},[e(h.a,[t._v("mdi-delete")])],1)],1)])}))],2),t._v(" "),e(o.a,{staticClass:"my-3",attrs:{color:"blue",outlined:""},on:{click:t.agregarFila}},[t._v("\n          Agregar nueva fila\n        ")]),t._v(" "),e(x.a,[e(l.a,{attrs:{cols:"12",sm:"4","offset-sm":"8"}},[e(x.a,[e(l.a,[e("p",[e("strong",[t._v("Subtotal:")]),t._v(" "+t._s(t.subtotal))]),t._v(" "),e("p",[e("strong",[t._v("Impuestos:")]),t._v(" "+t._s(t.impuestos))]),t._v(" "),e("p",[e("strong",[t._v("Total:")]),t._v(" "+t._s(t.total))])])],1)],1)],1),t._v(" "),e(x.a,[e(l.a,{staticClass:"d-flex align-center",attrs:{cols:"12"}},[e("h4",{staticClass:"mr-2"},[t._v("\n              Notas\n            ")]),t._v(" "),e(k.a,{attrs:{label:"Notas",dense:"",outlined:""},model:{value:t.notas,callback:function(e){t.notas=e},expression:"notas"}})],1)],1),t._v(" "),e(x.a,[e(l.a,{staticClass:"d-flex justify-space-between",attrs:{cols:"12"}},[e(o.a,{attrs:{outlined:"",color:"grey"},on:{click:t.cancelar}},[t._v("\n              Cancelar\n            ")]),t._v(" "),e(o.a,{attrs:{color:"blue"},on:{click:t.guardarCotizacion}},[t._v("\n              "+t._s(t.inside&&t.update?"Actualizar":t.inside?"Crear":"")+"\n            ")])],1)],1)],1)],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports}}]);